"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.localStorageBackend = void 0;

var _rxjs = require("rxjs");

const tryParse = (val, defValue) => {
  try {
    return JSON.parse(val);
  } catch (err) {
    // eslint-disable-next-line no-console
    console.warn("Failed to parse settings: ".concat(err.message));
    return defValue;
  }
};

const get = (key, defValue) => {
  const val = localStorage.getItem(key);
  return (0, _rxjs.of)(val === null ? defValue : tryParse(val, defValue));
};

const set = (key, nextValue) => {
  // Can't stringify undefined, and nulls are what
  // `getItem` returns when key does not exist
  if (typeof nextValue === 'undefined' || nextValue === null) {
    localStorage.removeItem(key);
  } else {
    localStorage.setItem(key, JSON.stringify(nextValue));
  }

  return (0, _rxjs.of)(nextValue);
};

const localStorageBackend = {
  get,
  set
};
exports.localStorageBackend = localStorageBackend;